

文档记录
********************************************

1. 所有图片放在 /static/picture文件夹
2. 已整理好的从马晨拷贝过来到 a正畸文件夹，此文件夹下所有患者不动，以后上传至该文件夹
3， 新建患者放到根目录下，文件夹命名规则 张飞_3333
4,  新建患者图片命名 姓名_日期_随机数字， 张飞_180202_22333
5，无病历号, 则文件夹设置为 姓名_0000, 病历号为空
6, 文件夹开头不要'/', 结尾要加'/'  static/picture/x/
    6.1 一定要检查是否有'/'
   图片地址必须开头 / ,方便网页使用  /static/picture/x/x/x/.jpg

7. post type>100 是易看牙导入的x光
8. tag type=101 为其他


备份：
1. 每周3晚上备份至nas
2. nas内部自动备份
3. TODO：每天备份数据库，自动删除以前的


TODO: 张栋梁名下, 有很多患者重复登记
todo:  部分'a正畸患者'内部有的，再导入时会在static/picture根目录下重建新的privateDir，就是相当于有两个文件夹，但是网站显示没问题。。。
todo： 根据post name调整顺序后，网页中顺序是按照type排序，都是正常。
        TODO：但是每个文件名内部的S1。。2等，没有跟着变化。需要时间调整一下，不然下载后容易混乱
TODO：上传时应该先判断是否填写上传日期，如果有，则文件命名用上传内容，如果没有，用当前日期
        如果是老照片，则重新排序。。。



# 获得外网地址
# 自行测试哪个代码能获取正确的IP，删除前面的#可生效
arIpAddress () {
curltest=`which curl`
if [ -z "$curltest" ] || [ ! -s "`which curl`" ] ; then
    #wget --no-check-certificate --quiet --output-document=- "http://www.ipip.net" | grep "您当前的IP：" | grep -E -o '([0-9]+\.){3}[0-9]+'
    wget --no-check-certificate --quiet --output-document=- "http://members.3322.org/dyndns/getip" | grep -E -o '([0-9]+\.){3}[0-9]+'
    #wget --no-check-certificate --quiet --output-document=- "1212.ip138.com/ic.asp" | grep -E -o '([0-9]+\.){3}[0-9]+'
    #wget --no-check-certificate --quiet --output-document=- "ip.6655.com/ip.aspx" | grep -E -o '([0-9]+\.){3}[0-9]+'
    #wget --no-check-certificate --quiet --output-document=- "ip.3322.net" | grep -E -o '([0-9]+\.){3}[0-9]+'
else
    #curl -k -s "http://www.ipip.net" | grep "您当前的IP：" | grep -E -o '([0-9]+\.){3}[0-9]+'
    curl -k -s "http://members.3322.org/dyndns/getip" | grep -E -o '([0-9]+\.){3}[0-9]+'
    #curl -k -s 1212.ip138.com/ic.asp | grep -E -o '([0-9]+\.){3}[0-9]+'
    #curl -k -s ip.6655.com/ip.aspx | grep -E -o '([0-9]+\.){3}[0-9]+'
    #curl -k -s ip.3322.net | grep -E -o '([0-9]+\.){3}[0-9]+'
fi
}
arIpAddress=$(arIpAddress)