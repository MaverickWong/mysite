{% extends 'base.html' %}
{% load  static %}

{% block content %}
    <script src="{% static '/js/moment.js' %}"></script>
    <script src="{% static '/js/bootstrap-datetimepicker.min.js' %}"></script>
    <link rel="stylesheet" href="{% static '/css/bootstrap-datetimepicker.min.css' %}">


    {#<div class="container">#}
    <div class="row">
        <div class='col-sm-6 col-md-2'>
            <input type='text' class="form-control" id='datetimepicker'/>
        </div>
        <a class="btn btn-default" onclick="queryAppts(this)"> 查询</a>
        <a class="btn btn-default" href="{% url 'appointment:update_today' %}"> 刷新今天</a>
    </div>

    <div class="col-md-12">
        <table class="table table-striped table-hover">
            <tr style="background-color: #cedeff">
                <th>序号</th>
                <th>患者</th>
                <th>时间</th>
                <th>类型</th>
                <th>医生</th>
                <th>备注</th>
                <th>状态</th>
                <th>checkin</th>
                <th>checkin时间</th>
                <th>入座</th>
                <th>结束</th>
            </tr>

            {% for appt in apptItem %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{% url 'person_detail' appt.patient.pk %}"> {{ appt.patient }} </a></td>
                    <td>{{ appt.startDateTime |time:"H:i" }}</td>
                    <td>{% if appt.checkInType == '初诊' %}  {{ appt.checkInType }}
                        <i class="fa fa-check-circle-o " style="color: #00a157"></i>
                    {% else %}  {{ appt.checkInType }}
                    {% endif %}
                    </td>
                    <td>{{ appt.doctorName|default_if_none:'_' }}</td>
                    <td>{{ appt.comment|default_if_none:'' }}</td>
                    <td> <!---状态-->
                        {% if appt.isCancel %} <strong>已取消</strong>
                        {% elif appt.isLeft %} 已离开
                        {% elif appt.isFinished %} <strong style="background-color: #93C763">已完成</strong>
                        {% elif appt.isCheckedIn %} 已挂号
                        {% elif appt.isSeated %} 已接诊
                        {% elif appt.isPending %} <strong style="background-color: #c74e55">在等待</strong>
                        {% else %} 迟到
                        {% endif %}
                    </td>
                    <td>{% if appt.isCheckedIn %}  <i class="fa fa-check-circle-o fa-2x" style="color: #00a157"></i>
                    {% else %}  <i class="fa fa-circle-o"></i>
                    {% endif %}
                    </td>
                    <td>{{ appt.checkInTime|time:"H:i" }}</td>
                    <td>{% if appt.isSeated %}  <i class="fa fa-check-circle-o fa-2x" style="color: #00a157"></i>
                    {% else %}  <i class="fa fa-circle-o"></i>
                    {% endif %}
                    </td>
                    <td>{% if appt.isFinished %}  <i class="fa fa-check-circle-o fa-2x" style="color: #00a157"></i>
                    {% else %}  <i class="fa fa-circle-o"></i>
                    {% endif %}
                    </td>
                </tr>

            {% endfor %}

        </table>

    </div>


    {#</div>#}


    <script type="text/javascript">
        $(function () {
            $('#datetimepicker').datetimepicker({
                showTodayButton: true,
                format: 'YYYY-MM-DD',
            });
        });

        function queryAppts() {
            var url = '/appt/?date=' + $('#datetimepicker').val()
            {#window.location.href(url)#}
            location.assign(url)
        }
    </script>

{% endblock %}